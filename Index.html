<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronic Kidney Disease Prediction Tool</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f9fc;
        }
        
        header {
            background-color: #1a6fc9;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        h1, h2 {
            color: #1a6fc9;
        }
        
        .form-section, #result, #visualizations {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin: 15px 0 5px;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        button {
            background-color: #1a6fc9;
            color: white;
            border: none;
            padding: 12px 20px;
            margin-top: 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #145da0;
        }
        
        .hidden {
            display: none;
        }
        
        .risk-high {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .risk-medium {
            color: #f39c12;
            font-weight: bold;
        }
        
        .risk-low {
            color: #27ae60;
            font-weight: bold;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            font-size: 14px;
            color: #666;
        }
        
        .additional-info {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        /* Chatbot styles */
        #chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        #chatbot-toggle {
            background-color: #1a6fc9;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        #chatbot-iframe {
            width: 350px;
            height: 500px;
            border: none;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            margin-bottom: 10px;
        }
        
        #chatbot-fallback {
            display: none;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        
        .chatbot-visible #chatbot-iframe,
        .chatbot-visible #chatbot-fallback {
            display: block;
        }
        
        /* Visualization styles */
        .chart-container {
            width: 100%;
            margin: 20px 0;
        }
        
        .chart {
            width: 100%;
            height: 300px;
            background-color: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .chart-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #1a6fc9;
            transition: height 1s ease;
            border-radius: 4px 4px 0 0;
        }
        
        .chart-label {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
        }
        
        .risk-factors {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        .risk-factor {
            background-color: #e8f4fc;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }
        
        .risk-factor.high {
            background-color: #fde8e8;
            color: #e74c3c;
        }
        
        .risk-factor.medium {
            background-color: #fef5e8;
            color: #f39c12;
        }
        
        .download-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .download-btn {
            background-color: #27ae60;
        }
        
        .download-btn:hover {
            background-color: #219653;
        }
        
        .visualization-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        /* Symptom checkbox styles */
        .symptom-checkboxes {
            margin-top: 15px;
        }
        
        .symptom-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .symptom-checkbox input {
            width: auto;
            margin-right: 10px;
        }
        
        .symptom-checkbox label {
            margin: 0;
            font-weight: normal;
            display: inline;
        }
        
        /* Form validation styles */
        input:invalid, select:invalid {
            border-color: #e74c3c;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        /* Loading spinner */
        .spinner {
            display: none;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #1a6fc9;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .visualization-grid {
                grid-template-columns: 1fr;
            }
            
            .download-buttons {
                flex-direction: column;
            }
            
            #chatbot-iframe,
            #chatbot-fallback {
                width: 280px;
                height: 400px;
            }
        }
    </style>
    <!-- Chart.js library for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- html2canvas for report download -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <header>
        <h1>Chronic Kidney Disease Prediction Tool</h1>
        <p>This tool evaluates your risk factors for developing chronic kidney disease</p>
    </header>

    <section class="form-section">
        <h2>Patient Information</h2>
        <form id="ckd-form">
            <!-- [All your existing form elements remain exactly the same] -->
            <!-- ... -->
            
            <div class="spinner" id="form-spinner"></div>
            <button type="submit" id="submit-btn">Calculate My CKD Risk</button>
        </form>
    </section>

    <section id="result" class="hidden">
        <!-- [All your existing result elements remain exactly the same] -->
        <!-- ... -->
    </section>

    <section id="visualizations" class="hidden">
        <!-- [All your existing visualization elements remain exactly the same] -->
        <!-- ... -->
    </section>

    <footer>
        <p><strong>Disclaimer:</strong> This tool is for informational purposes only and is not a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition.</p>
        <p>Based on clinical guidelines from the National Kidney Foundation and KDIGO.</p>
    </footer>

    <!-- Chatbot Container with Fallback -->
    <div id="chatbot-container">
        <iframe id="chatbot-iframe" src="https://agent.jotform.com/0195bf7a139274149d20a98efdf483b08976" 
                title="CKD Assistant Chatbot"></iframe>
        
        <!-- Fallback Simple Chatbot -->
        <div id="chatbot-fallback">
            <div id="chatbot-messages">
                <div style="text-align:center; padding:10px; color:#666;">
                    <p>Welcome to CKD Assistant</p>
                    <p>Ask me about kidney disease risk factors</p>
                </div>
            </div>
            <input type="text" id="chatbot-input" placeholder="Type your question..." 
                   style="width:100%; padding:10px; margin-top:10px; border:1px solid #ddd; border-radius:4px;">
        </div>
        
        <button id="chatbot-toggle">ðŸ’¬</button>
    </div>

    <script>
        // [All your existing CKD calculation JavaScript remains the same]
        // ...

        // Enhanced Chatbot Implementation
        document.addEventListener('DOMContentLoaded', function() {
            const chatbotIframe = document.getElementById('chatbot-iframe');
            const chatbotFallback = document.getElementById('chatbot-fallback');
            const chatbotToggle = document.getElementById('chatbot-toggle');
            const chatbotContainer = document.getElementById('chatbot-container');
            
            // Check if iframe loaded successfully
            let iframeLoaded = false;
            
            chatbotIframe.addEventListener('load', function() {
                iframeLoaded = true;
                console.log('Chatbot iframe loaded successfully');
            });
            
            chatbotIframe.addEventListener('error', function() {
                console.log('Chatbot iframe failed to load, using fallback');
                this.style.display = 'none';
                chatbotFallback.style.display = 'block';
                iframeLoaded = false;
            });
            
            // Toggle chatbot visibility
            chatbotToggle.addEventListener('click', function() {
                chatbotContainer.classList.toggle('chatbot-visible');
                
                // If iframe failed to load, ensure fallback is visible
                if(!iframeLoaded && chatbotContainer.classList.contains('chatbot-visible')) {
                    chatbotIframe.style.display = 'none';
                    chatbotFallback.style.display = 'block';
                }
            });
            
            // Simple fallback chatbot functionality
            const chatbotInput = document.getElementById('chatbot-input');
            const chatbotMessages = document.getElementById('chatbot-messages');
            
            chatbotInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && this.value.trim() !== '') {
                    const question = this.value;
                    this.value = '';
                    
                    // Add user message
                    addChatMessage(question, 'user');
                    
                    // Simple bot response
                    setTimeout(() => {
                        const responses = [
                            "Chronic kidney disease (CKD) means your kidneys are damaged and can't filter blood properly.",
                            "Common risk factors include diabetes, high blood pressure, heart disease, and family history.",
                            "You can reduce risk by controlling blood sugar, maintaining healthy blood pressure, and avoiding NSAIDs.",
                            "For personalized advice, please consult your healthcare provider.",
                            "Early stages of CKD often have no symptoms, so regular checkups are important."
                        ];
                        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                        addChatMessage(randomResponse, 'bot');
                    }, 800);
                }
            });
            
            function addChatMessage(message, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.style.margin = '5px 0';
                messageDiv.style.textAlign = sender === 'user' ? 'right' : 'left';
                
                const messageSpan = document.createElement('span');
                messageSpan.style.padding = '8px 12px';
                messageSpan.style.borderRadius = '15px';
                messageSpan.style.display = 'inline-block';
                messageSpan.style.maxWidth = '80%';
                
                if(sender === 'user') {
                    messageSpan.style.background = '#1a6fc9';
                    messageSpan.style.color = 'white';
                } else {
                    messageSpan.style.background = '#e8f4fc';
                    messageSpan.style.color = '#333';
                }
                
                messageSpan.textContent = message;
                messageDiv.appendChild(messageSpan);
                chatbotMessages.appendChild(messageDiv);
                
                // Scroll to bottom
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            }
        });
    </script>
</body>
</html>
